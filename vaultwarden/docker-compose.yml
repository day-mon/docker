version: '3.7'
services:
    vaultwarden:
      image: vaultwarden/server:latest
      container_name: vaultwarden
      restart: always
      env_file:
        - config.env
      networks:
        - traefik
        - mail
        - database
      volumes:
        - ./.data:/data/
        - /usr/share/ca-certificates/mozilla:/usr/share/ca-certificates/mozilla:ro
      labels:
        traefik.enable: true
        traefik.http.routers.vault.rule: Host(`vault.$PRIMARY_DOMAIN`)
        traefik.http.routers.vault.entrypoints: https
        traefik.http.services.vault.loadbalancer.server.port: 80
        traefik.http.routers.vault.middlewares: authelia@docker

networks:
  traefik:
    external: true
  database:
    external: true
  mail:
    external: true
